# VoxFilter — Evidence Ledger (Repo-verified)

This ledger maps each reported symptom to a root cause, **with exact repo file/line evidence**, plus how it was confirmed and what was changed to prevent silent failures.

## Evidence table

| Symptom | Root cause | Repo evidence (file:lines) | How confirmed | Fix (file:lines) |
|---|---|---|---|---|
| Users can toggle effects but hear no difference; UI often shows processing inactive | Effects are now explicitly gated in the UI so users can’t believe features are “working” while processing is OFF | `client/src/components/audio-controls.tsx` L161 (processing-off banner), L241 (Noise Reduction switch gated), L278 (Voice Modifier switch gated) | Verified UI disables Noise Reduction + Voice Modifier controls and shows an “Audio processing is OFF” warning | `client/src/components/audio-controls.tsx` L161, L241, L278 |
| “Start Audio Processing” fails and user can’t recover without refresh (silent no-op on retry) | `initialize()` failure must hard-clean up refs; otherwise `audioContextRef.current` stays set and blocks future initialization attempts | `client/src/hooks/use-audio-processor.ts` L301-L308 (guard) and L533-L538 (catch calls `stop(errorMessage)` and rethrows) | Deterministic: if `initialize()` throws, you now get `VoxFilter: initialize() failed` + cleanup via `stop()`, and a subsequent click can re-initialize | `client/src/hooks/use-audio-processor.ts` L533-L538 + `stop()` hard cleanup (`stop()` is earlier in same file) |
| Call app hears unprocessed mic or silence even after “processing started” | Output routing to the virtual cable must be explicit, testable, and must not claim “active” unless `setSinkId` + `play()` succeeded (autoplay policy + sink routing failures are common) | `client/src/hooks/use-audio-processor.ts` L504-L520 (initialize sets routing statuses to inactive/unsupported and does **not** auto-play) and `enableOutput()` state update + status reporting `client/src/hooks/use-audio-processor.ts` L1010-L1068 | Verified by required structured logs: `VoxFilter: initialize() success` and `VoxFilter: enableOutput() result` + explicit UI chips (Blocked/Failed) | Hook: `client/src/hooks/use-audio-processor.ts` L504-L520 and L1010-L1068. UI: `client/src/components/audio-controls.tsx` L487-L611 (status chips + callAppReady + disable/enable gating) |
| UI could indicate “Active” even when virtual cable routing isn’t actually ready | “Call app ready” must depend on **virtual routing active** and the selected output device resembling VB-Audio/BlackHole | `client/src/components/audio-controls.tsx` L126-L131 (label + virtual detection) and L503-L525 (ready/not-ready banners) | Verified in UI: `Call app ready: YES` only shows when `isVirtualOutputEnabled` and selected label matches virtual-cable heuristics | `client/src/components/audio-controls.tsx` L126-L131 and L503-L525 |
| No reliable proof that processed stream is live + routable (support can’t debug “silent” cases) | Add built-in self-test that starts processing if needed, records 3 seconds from processed stream, attempts playback, and reports device list + routing status | Hook self-test: `client/src/hooks/use-audio-processor.ts` L1159-L1393 (runSelfTest steps include tracks/devices/record/playback/virtual routing). UI render: `client/src/components/audio-controls.tsx` L613-L680 (button + report rendering) | Confirm via UI “Test Processed Audio (3s)” showing step breakdown and console `VoxFilter: self-test complete` | `client/src/hooks/use-audio-processor.ts` L1159-L1393 and `client/src/components/audio-controls.tsx` L613-L680 |
| “Accent doesn’t change” expectations (pitch vs “accent conversion”) | Current “Voice Modifier” is **tone/formant shaping**; phoneme-level accent conversion is not implemented. Also `pitchShift` is currently not applied in the audio graph. | Hook computes `pitchShift` but branches only on `formantShift` (`client/src/hooks/use-audio-processor.ts` L596-L607). UI explicitly documents this limitation (`client/src/components/audio-controls.tsx` L337 and L362). | Confirmed by code inspection: no node params are changed based on `pitchShift` (only formant/EQ-like filters are modified). UI prevents “it should work” confusion by disabling pitch slider. | `client/src/components/audio-controls.tsx` L337 and L362. Hook evidence: `client/src/hooks/use-audio-processor.ts` L596-L607 |

## Notes / follow-ups

- **Virtual cable routing is browser-dependent**: if `setSinkId` is unsupported, the UI shows **Unsupported** with next steps.
- **Autoplay policy** is surfaced as **Blocked**, not silent failure.
- The self-test report is designed to be “support pasteable” (overall status + step statuses + device list).

